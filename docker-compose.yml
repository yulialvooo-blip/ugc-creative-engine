version: '3.8'

services:
  postgres:
      image: postgres:15-alpine
          container_name: ugc_postgres
              environment:
                    POSTGRES_USER: postgres
                          POSTGRES_PASSWORD: password
                                POSTGRES_DB: ugc_engine
                                    ports:
                                          - "5432:5432"
                                              volumes:
                                                    - postgres_data:/var/lib/postgresql/data
                                                          - ./database.sql:/docker-entrypoint-initdb.d/init.sql
                                                              healthcheck:
                                                                    test: ["CMD-SHELL", "pg_isready -U postgres"]
                                                                          interval: 10s
                                                                                timeout: 5s
                                                                                      retries: 5

                                                                                        backend:
                                                                                            build:
                                                                                                  context: .
                                                                                                        dockerfile: Dockerfile.backend
                                                                                                            container_name: ugc_backend
                                                                                                                ports:
                                                                                                                      - "5000:5000"
                                                                                                                          environment:
                                                                                                                                NODE_ENV: development
                                                                                                                                      PORT: 5000
                                                                                                                                            DATABASE_URL: postgresql://postgres:password@postgres:5432/ugc_engine
                                                                                                                                                  JWT_SECRET: ugc_engine_secret_key_here
                                                                                                                                                        REPLICATE_API_TOKEN: placeholder
                                                                                                                                                              BANANA_API_KEY: placeholder
                                                                                                                                                                    ELEVENLABS_API_KEY: placeholder
                                                                                                                                                                          META_ACCESS_TOKEN: placeholder
                                                                                                                                                                              depends_on:
                                                                                                                                                                                    postgres:
                                                                                                                                                                                            condition: service_healthy
                                                                                                                                                                                                volumes:
                                                                                                                                                                                                      - .:/app
                                                                                                                                                                                                            - /app/node_modules
                                                                                                                                                                                                                command: npm run dev
                                                                                                                                                                                                                
                                                                                                                                                                                                                  frontend:
                                                                                                                                                                                                                      build:
                                                                                                                                                                                                                            context: ./frontend
                                                                                                                                                                                                                                  dockerfile: Dockerfile
                                                                                                                                                                                                                                      container_name: ugc_frontend
                                                                                                                                                                                                                                          ports:
                                                                                                                                                                                                                                                - "3000:3000"
                                                                                                                                                                                                                                                    environment:
                                                                                                                                                                                                                                                          REACT_APP_API_URL: http://localhost:5000/api
                                                                                                                                                                                                                                                              depends_on:
                                                                                                                                                                                                                                                                    - backend
                                                                                                                                                                                                                                                                        volumes:
                                                                                                                                                                                                                                                                              - ./frontend:/app
                                                                                                                                                                                                                                                                                    - /app/node_modules
                                                                                                                                                                                                                                                                                        command: npm start
                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                        volumes:
                                                                                                                                                                                                                                                                                          postgres_data:
